## 3.5 指針（Pointer）與位址空間（Address Space） (LLVM IR)

在 LLVM IR 中，指針（Pointer）用來表示記憶體中的位址，讓我們可以存取和操作記憶體中的數據。指針在 LLVM IR 中被視為一種數值型別，用來表示記憶體位址。

在 LLVM IR 中，指針的型別由位址空間（Address Space）來定義。位址空間是一種用來區分記憶體區域的方式，每個位址空間都有自己獨立的記憶體位址範圍。LLVM IR 中預定義了一些常見的位址空間，例如位址空間 0 用於表示非限定位址的全域變數，位址空間 1 用於表示堆上的動態分配記憶體，位址空間 2 用於表示程式碼等。

指針型別的語法是以星號（*）作為標誌，接著是位址空間號碼。例如，`i32*` 表示一個指向位址空間 0 中的 32 位整數型別的指針；`double*` 表示一個指向位址空間 0 中的雙精度浮點數型別的指針。

在 LLVM IR 中，我們可以使用 `alloca` 指令來在堆疊上分配一個指標變數。例如，以下是一段 LLVM IR 代碼，展示了如何建立一個指向整數型別的指標變數 `ptr`：

```llvm
%ptr = alloca i32*, align 8
```

這段代碼將在堆疊上分配一個 8 位元對齊的指標變數 `ptr`，該指標指向一個位址空間 0 中的 32 位整數。

我們可以使用 `load` 指令來載入指標所指向的數值，以及使用 `store` 指令將數值存儲到指標所指向的位址中。例如，以下是如何載入和存儲指標所指向的整數：

```llvm
%val = load i32, i32* %ptr
store i32 %val, i32* %ptr
```

這段代碼載入指標 `ptr` 所指向的整數到變數 `val` 中，並將變數 `val` 的值存儲到指標 `ptr` 所指向的位址中。

指針在 LLVM IR 中非常重要，因為它們允許我們直接存取和操作記憶體中的數據。它們在編譯器優化和代碼生成中起著關鍵作用，同時也提供了靈活的記憶體管理方式。