# 第三章：LLVM IR 的數值表示

## 介紹
在 LLVM 中，LLVM IR（Intermediate Representation，中間表示）是一種中間語言，它被用於在高階語言和機器碼之間進行翻譯和優化。LLVM IR 是一種靜態單賦值（Static Single Assignment，SSA）形式的語言，它將程序的控制流和資料流分開處理。本章將介紹 LLVM IR 中的數值表示。

## 常數
在 LLVM IR 中，常數是不可變的值或表達式，它們可以是整數、浮點數、指針、結構體等。常數可以用來初始化變數或作為運算的操作數。

### 整數常數
在 LLVM IR 中，整數常數以十進制或十六進制表示。例如，以下是一個十進制表示的整數常數：
```llvm
i32 42
```
這表示一個 32 位整數常數 42。要表示負數常數，可以使用負號：
```llvm
i32 -10
```
十六進制表示的整數常數以 `0x` 開頭。例如：
```llvm
i32 0x2a
```
這表示一個 32 位整數常數 42。

### 浮點數常數
在 LLVM IR 中，浮點數常數以十進制表示。例如：
```llvm
float 3.14
```
這表示一個單精度浮點數常數 3.14。如果要表示雙精度浮點數常數，可以使用 `double` 關鍵字。

### 指針常數
在 LLVM IR 中，指針常數用於表示記憶體中的地址。指針常數的表示方式取決於目標平台的位址空間。例如，以下是一個指向整數變數 `x` 的指針常數：
```llvm
i32* @x
```
要表示空指針常數，可以使用 `null` 關鍵字：
```llvm
i32* null
```

### 結構體常數
在 LLVM IR 中，結構體常數用於表示結構體的初始化值。結構體常數的表示方式是以大括號 `{}` 包圍的值列表。例如，以下是一個包含兩個整數的結構體常數：
```llvm
{ i32 10, i32 20 }
```

## 變數
在 LLVM IR 中，變數是可變的值或表達式。變數可以是整數、浮點數、指針、結構體等。變數用於存儲和操作數據。

### 命名
在 LLVM IR 中，變數通過符號名稱來表示。符號名稱以 `@` 字元開頭，後面跟著名稱。例如，以下是一個整數變數 `x` 的表示方式：
```llvm
@x = i32 42
```

### 類型
在 LLVM IR 中，每個變數都有一個對應的類型。類型表示變數的數據類型。例如，整數變數的類型可以是 `i32`，浮點數變數的類型可以是 `float`。類型在變數聲明時指定。

### 全局變數
在 LLVM IR 中，全局變數是在函數外定義的變數。全局變數在整個程序執行期間都是可見的。以下是一個全局整數變數的例子：
```llvm
@x = global i32 42
```
全局變數可以被其他函數引用，也可以在函數中進行賦值和取值操作。

### 局部變數
在 LLVM IR 中，局部變數是在函數內部定義的變數。局部變數只在所屬函數中可見，其他函數無法引用它。以下是一個局部整數變數的例子：
```llvm
define i32 @foo() {
  %x = alloca i32
  store i32 42, i32* %x
  %result = load i32, i32* %x
  ret i32 %result
}
```
在上面的例子中，我們在函數 `foo` 中定義了一個局部整數變數 `x`，並將 42 存儲到該變數中。然後，我們使用 `load` 指令將變數的值載入到 `result` 變數中。最後，我們使用 `ret` 指令返回 `result` 變數的值。

## 運算符
在 LLVM IR 中，運算符用於對數值進行計算和操作。運算符可以是算術運算符、邏輯運算符、位運算符等。

### 算術運算符
在 LLVM IR 中，算術運算符用於執行數學計算，例如加法、減法、乘法和除法。以下是一些算術運算符的例子：
- 加法：`add`
- 減法：`sub`
- 乘法：`mul`
- 除法：`sdiv`（帶符號除法）或 `udiv`（無符號除法）
- 取餘：`srem`（帶符號取餘）或 `urem`（無符號取餘）

### 邏輯運算符
在 LLVM IR 中，邏輯運算符用於執行布爾運算，例如與、或和非。以下是一些邏輯運算符的例子：
- 與：`and`
- 或：`or`
- 非：`not`

### 位運算符
在 LLVM IR 中，位運算符用於對二進製數進行位運算。以下是一些位運算符的例子：
- 按位與：`and`
- 按位或：`or`
- 按位非：`not`
- 按位互斥或：`xor`
- 左移：`shl`
- 右移：`lshr`（邏輯右移）或 `ashr`（算術右移）

### 其他運算符
除了上述運算符之外，LLVM IR 還提供了其他一些運算符，用於執行評估和內存操作。例如：
- 比較運算符：用於比較兩個值是否相等或大小關係。例如，`icmp eq` 用於比較等於，`icmp slt` 用於比較小於。
- 矢量運算符：用於進行矢量計算。例如，`add <4 x i32>` 用於對四個 32 位整數進行相加。
- 加載和存儲指令：用於從內存中讀取和寫入數據。例如，`load` 用於從指定地址加載數據到變數中，`store` 用於將變數的值存儲到指定地址中。

## 總結
本章介紹了 LLVM IR 中的數值表示，包括常數、變數和運算符。常數用於表示不可變的數值或表達式，變數用於存儲和操作數據，運算符用於對數值進行計算和操作。在下一章中，我們將介紹如何在 LLVM IR 中定義函數和基本塊。

[to be continued...]